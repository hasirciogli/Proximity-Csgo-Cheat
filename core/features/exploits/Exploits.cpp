#include "Exploits.hpp"

#include <core/menu/variables.hpp>


bool Exploits::double_tap(c_usercmd* m_pcmd)
{
	static float lastdoubletaptime = 0.0f;
	if (!variables::Aimbot_Settings::doubletap_enabled)
	{
		globals::double_tap_aim = false;
		globals::double_tap_aim_check = false;
		globals::shift_ticks = globals::tocharge;
		return false;
	}
	auto weapon = csgo::local_player->active_weapon();
	if (!(m_pcmd->buttons & in_attack) && globals::tocharge < 14 && abs(globals::fixed_tickbase - lastdoubletaptime) >= TIME_TO_TICKS(0.6)) {
		this->double_tap_enabled = false;
		globals::should_recharge = true;
		globals::tochargeamount = 14; 
	}
	else {
		this->double_tap_enabled = true;
		globals::should_recharge = false;
	}

	if (globals::tocharge > 14) {
		globals::shift_ticks = globals::tocharge - 14;
	}

	if (weapon && (m_pcmd->buttons & in_attack || (m_pcmd->buttons & in_attack2 && weapon->is_knife())) && globals::tocharge >= 14) {
		lastdoubletaptime = globals::fixed_tickbase;

		globals::tickbase_shift = 14;
		globals::shift_ticks = 14;
		globals::shot_command = m_pcmd->command_number;
		//defensive(m_pcmd);
	}

	if (globals::aimbot_working)
	{
		globals::double_tap_aim = true;
		globals::double_tap_aim_check = true;
	}
	if (globals::tickbase_shift <= 0)
		globals::tickbase_shift = globals::shift_ticks;
	return true;
}